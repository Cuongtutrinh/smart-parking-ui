<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Smart Parking Dashboard</title>
  <style>
    body{font-family:Arial; margin:20px}
    .slot{display:inline-block; width:120px; padding:10px; margin:6px; border-radius:6px; text-align:center;}
    .occ{background:#f88}
    .free{background:#8f8}
    #log{max-height:300px; overflow:auto; border:1px solid #ddd; padding:8px}
  </style>
</head>
<body>
  <h1>Smart Parking Dashboard</h1>
  <div>Total: <span id="total">-</span> &nbsp; Available: <span id="avail">-</span></div>
  <h3>Slots</h3>
  <div id="slots"></div>
  <h3>Events</h3>
  <div id="log"></div>

  <script src="https://duaniot-0yrv.onrender.com/socket.io/socket.io.js"></script>
  <script>
    const socket = io("https://duaniot-0yrv.onrender.com");
    const totalEl = document.getElementById('total');
    const availEl = document.getElementById('avail');
    const slotsEl = document.getElementById('slots');
    const logEl = document.getElementById('log');

    function renderState(s){
      totalEl.textContent = s.total;
      availEl.textContent = s.available;
      slotsEl.innerHTML = '';
      s.slots.forEach((v,i)=>{
        const d = document.createElement('div');
        d.className = 'slot ' + (v ? 'occ' : 'free');
        d.innerHTML = '<strong>Slot ' + (i+1) + '</strong><div>' + (v ? 'OCCUPIED' : 'EMPTY') + '</div>';
        slotsEl.appendChild(d);
      });
      // logs
      logEl.innerHTML = s.logs.slice(0,50).map(l=> `<div>[${new Date(l.time).toLocaleTimeString()}] ${l.msg}</div>`).join('');
    }

    socket.on('connect', ()=> console.log('connected'));
    socket.on('update', (s)=>{
      renderState(s);
    });

    // fetch initial state
   fetch("https://duaniot-0yrv.onrender.com/state")
    .then(r => r.json())
    .then(s => renderState(s))
    .catch(e => console.log(e));
  </script>
</body>
</html>

